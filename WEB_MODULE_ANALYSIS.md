# Monolith Web æ¨¡å—åˆ†ææŠ¥å‘Š

## ğŸ“‹ æ¦‚è¿°

æœ¬æŠ¥å‘Šæ·±å…¥åˆ†æäº† Monolith è½»é‡ç‰ˆçš„ Web æ¨¡å—æ¶æ„ã€åŠŸèƒ½å’Œå·¥ä½œæµç¨‹ã€‚Web æ¨¡å—å·²ç»è¿‡é‡å¤§è½»é‡åŒ–æ”¹é€ ï¼Œä¸“æ³¨äºæä¾›ä¹¦ç­¾è„šæœ¬é©±åŠ¨çš„ç½‘é¡µå¤„ç†æœåŠ¡ã€‚

## ğŸ—ï¸ æ¨¡å—ç»“æ„åˆ†æ

### æ ¸å¿ƒç›®å½•ç»“æ„

```
src/web/
â”œâ”€â”€ mod.rs              # Web æ¨¡å—ä¸»å…¥å£ï¼ŒWebServer ç»“æ„å®šä¹‰
â”œâ”€â”€ config.rs           # ç®€åŒ–çš„é…ç½®ç®¡ç†ï¼ˆç§»é™¤äº†MongoDBé…ç½®ï¼‰
â”œâ”€â”€ types.rs            # æ•°æ®ç±»å‹å®šä¹‰ï¼ˆç®€åŒ–çš„AppStateï¼‰
â”œâ”€â”€ routes.rs           # è½»é‡åŒ–è·¯ç”±é…ç½®ï¼ˆ7ä¸ªæ ¸å¿ƒè·¯ç”±ï¼‰
â”œâ”€â”€ theme.rs            # ä¸»é¢˜ç®¡ç†ç³»ç»Ÿ
â””â”€â”€ handlers/           # è¯·æ±‚å¤„ç†å™¨
    â”œâ”€â”€ mod.rs          # å¤„ç†å™¨æ¨¡å—å¯¼å‡º
    â”œâ”€â”€ pages.rs        # é¡µé¢å¤„ç†å™¨ï¼ˆä¸»é¡µã€é¢„è§ˆï¼‰
    â””â”€â”€ api/            # API ç«¯ç‚¹å¤„ç†å™¨
        â”œâ”€â”€ mod.rs      # API æ¨¡å—å¯¼å‡º
        â”œâ”€â”€ process.rs  # æ ¸å¿ƒå¤„ç†APIï¼ˆæ–°å¢ï¼‰
        â”œâ”€â”€ translation.rs # ç¿»è¯‘API
        â”œâ”€â”€ content.rs  # å†…å®¹è·å–API
        â”œâ”€â”€ bookmarklet.rs # ä¹¦ç­¾è„šæœ¬ç”ŸæˆAPI
        â”œâ”€â”€ cache.rs    # ç¼“å­˜ç®¡ç†API
        â””â”€â”€ theme.rs    # ä¸»é¢˜API
```

### æ¨¡æ¿ç³»ç»Ÿç»“æ„

```
templates/
â”œâ”€â”€ README.md           # æ¨¡æ¿è¯´æ˜æ–‡æ¡£
â”œâ”€â”€ core/              # æ ¸å¿ƒæ¨¡æ¿
â”‚   â”œâ”€â”€ index.html     # å¤æ‚çš„åŸå§‹æ¨¡æ¿ï¼ˆå·²ä¸ä½¿ç”¨ï¼‰
â”‚   â””â”€â”€ simple_index.html # è½»é‡åŒ–ä¸»é¡µæ¨¡æ¿ï¼ˆå½“å‰ä½¿ç”¨ï¼‰
â””â”€â”€ assets/            # å‰ç«¯èµ„æºï¼ˆå¤§å¹…ç²¾ç®€ï¼‰
    â”œâ”€â”€ css/          # æ ·å¼æ–‡ä»¶
    â”‚   â”œâ”€â”€ base.css
    â”‚   â””â”€â”€ responsive.css
    â””â”€â”€ js/           # JavaScriptæ–‡ä»¶ï¼ˆç©ºç›®å½•ï¼‰
```

## ğŸ›£ï¸ è·¯ç”±ç³»ç»Ÿåˆ†æ

### å½“å‰è·¯ç”±é…ç½®

| è·¯ç”± | æ–¹æ³• | å¤„ç†å™¨ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|--------|------|------|
| `/` | GET | `index` | ä¸»é¡µ - ä¹¦ç­¾è„šæœ¬è·å– | âœ… æ ¸å¿ƒ |
| `/preview/*url` | GET | `preview_handler` | ç½‘é¡µé¢„è§ˆæ˜¾ç¤º | âœ… æ ¸å¿ƒ |
| `/api/process` | POST | `process_url` | æ ¸å¿ƒå¤„ç†API | âœ… æ–°å¢ |
| `/api/translate` | POST | `translate_url` | ç¿»è¯‘API | âœ… å¯é€‰ |
| `/api/content` | POST | `get_content` | å†…å®¹è·å–API | âœ… è¾…åŠ© |
| `/api/bookmarklet` | GET | `generate_bookmarklet` | ä¹¦ç­¾è„šæœ¬ç”Ÿæˆ | âœ… è¾…åŠ© |
| `/api/cache/clear` | POST | `clear_cache` | ç¼“å­˜ç®¡ç† | âœ… ç»´æŠ¤ |

### è½»é‡åŒ–æ”¹é€ æ•ˆæœ

- **è·¯ç”±æ•°é‡å‡å°‘**: ä»åŸæ¥çš„47ä¸ªè·¯ç”±ç²¾ç®€è‡³7ä¸ªï¼ˆ85%å‡å°‘ï¼‰
- **åŠŸèƒ½èšç„¦**: ä¸“æ³¨äºä¹¦ç­¾è„šæœ¬å·¥ä½œæµç¨‹
- **æ¶æ„ç®€åŒ–**: ç§»é™¤äº†å¤æ‚çš„åº“ç®¡ç†ã€ç»Ÿè®¡ç³»ç»Ÿç­‰åŠŸèƒ½

## ğŸ“Š å¤„ç†å™¨åŠŸèƒ½åˆ†æ

### é¡µé¢å¤„ç†å™¨ (`pages.rs`)

#### `index()` - ä¸»é¡µå¤„ç†å™¨
- **åŠŸèƒ½**: æä¾›ä¹¦ç­¾è„šæœ¬è·å–é¡µé¢
- **æ¨¡æ¿**: ä½¿ç”¨ `simple_index.html`
- **ç‰¹ç‚¹**: å†…è”CSSï¼Œå“åº”å¼è®¾è®¡ï¼Œäº¤äº’å¼ä¹¦ç­¾è„šæœ¬ç”Ÿæˆ

#### `preview_handler()` - é¢„è§ˆå¤„ç†å™¨
- **åŠŸèƒ½**: æ¥æ”¶URLï¼Œå¤„ç†ç½‘é¡µï¼Œè¿”å›å¸¦æ¨¡æ¿çš„é¢„è§ˆé¡µé¢
- **å·¥ä½œæµç¨‹**:
  1. URLéªŒè¯å’Œæ ¼å¼åŒ–
  2. è°ƒç”¨ `create_monolithic_document()` å¤„ç†
  3. ä½¿ç”¨ `create_preview_page()` ç”Ÿæˆæ¨¡æ¿
  4. è¿”å›iframeåµŒå…¥çš„é¢„è§ˆé¡µé¢
- **ä¼˜åŒ–**: ä½¿ç”¨ `tokio::spawn_blocking` å¤„ç†CPUå¯†é›†å‹ä»»åŠ¡

### APIå¤„ç†å™¨åˆ†æ

#### `/api/process` - æ ¸å¿ƒå¤„ç†APIï¼ˆæ–°å¢ï¼‰
```rust
// è¯·æ±‚ç»“æ„
{
  "url": "https://example.com",
  "translate": false,
  "target_lang": "zh",
  "options": {
    "no_css": false,
    "no_js": false,
    "no_images": false,
    "timeout": 30
  }
}

// å“åº”ç»“æ„
{
  "status": "success",
  "original_html": "...",
  "translated_html": null,
  "title": "é¡µé¢æ ‡é¢˜",
  "url": "https://example.com",
  "preview_url": "/preview/https%3A%2F%2Fexample.com"
}
```

**ç‰¹ç‚¹**:
- é›†æˆäº† `src/parsers` æ¨¡å—è¿›è¡Œèµ„æºå¤„ç†
- å¯é€‰é›†æˆ `src/translation` æ¨¡å—è¿›è¡Œç¿»è¯‘
- è¿”å›é¢„è§ˆURLä¾›å‰ç«¯è·³è½¬
- å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

#### `/api/translate` - ç¿»è¯‘API
- **åŠŸèƒ½**: å¹¶è¡Œå¤„ç†åŸæ–‡å’Œè¯‘æ–‡
- **é›†æˆ**: ä½¿ç”¨ `translate_dom_content_sync()` è¿›è¡Œç¿»è¯‘
- **ä¼˜åŒ–**: å¼‚æ­¥å¤„ç†ï¼Œé”™è¯¯å®¹é”™

#### å…¶ä»–APIç«¯ç‚¹
- `/api/content`: ç®€å•çš„å†…å®¹è·å–
- `/api/bookmarklet`: ä¹¦ç­¾è„šæœ¬ä»£ç ç”Ÿæˆ
- `/api/cache/clear`: åŸºç¡€ç¼“å­˜ç®¡ç†

## ğŸ”„ å·¥ä½œæµç¨‹åˆ†æ

### ä¹¦ç­¾è„šæœ¬å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    participant U as ç”¨æˆ·
    participant B as æµè§ˆå™¨
    participant S as MonolithæœåŠ¡å™¨
    participant P as Parsersæ¨¡å—
    participant T as Translationæ¨¡å—

    U->>B: è®¿é—®ä¸»é¡µè·å–ä¹¦ç­¾è„šæœ¬
    B->>S: GET /
    S->>B: è¿”å›åŒ…å«ä¹¦ç­¾è„šæœ¬çš„ä¸»é¡µ
    
    U->>B: åœ¨ç›®æ ‡ç½‘é¡µç‚¹å‡»ä¹¦ç­¾
    B->>S: POST /api/process {url, options}
    S->>P: è°ƒç”¨parserså¤„ç†ç½‘é¡µ
    P->>S: è¿”å›å¤„ç†åçš„HTML
    
    opt å¦‚æœå¯ç”¨ç¿»è¯‘
        S->>T: è°ƒç”¨translationæ¨¡å—
        T->>S: è¿”å›ç¿»è¯‘åçš„HTML
    end
    
    S->>B: è¿”å›å¤„ç†ç»“æœå’Œé¢„è§ˆURL
    B->>S: è‡ªåŠ¨è·³è½¬åˆ°é¢„è§ˆURL
    S->>B: è¿”å›é¢„è§ˆé¡µé¢ï¼ˆå¸¦æ¨¡æ¿ï¼‰
```

### æ•°æ®æµåˆ†æ

1. **è¾“å…¥**: ç”¨æˆ·é€šè¿‡ä¹¦ç­¾è„šæœ¬æä¾›URL
2. **å¤„ç†**: 
   - URLéªŒè¯å’Œæ ¼å¼åŒ–
   - è°ƒç”¨ `src/parsers` è¿›è¡Œèµ„æºæå–å’Œå†…åµŒ
   - å¯é€‰è°ƒç”¨ `src/translation` è¿›è¡Œç¿»è¯‘
3. **è¾“å‡º**: å¸¦æ¨¡æ¿çš„é¢„è§ˆé¡µé¢ï¼ŒåŒ…å«å¤„ç†åçš„å†…å®¹

## ğŸ›ï¸ æ¶æ„è®¾è®¡åˆ†æ

### AppState ç»“æ„ï¼ˆç®€åŒ–ç‰ˆï¼‰
```rust
pub struct AppState {
    pub monolith_options: MonolithOptions,  // æ ¸å¿ƒå¤„ç†é€‰é¡¹
    pub theme_manager: Arc<Mutex<ThemeManager>>, // ä¸»é¢˜ç®¡ç†
    // ç§»é™¤äº†: database, cache_manager, statistics ç­‰
}
```

### é…ç½®ç³»ç»Ÿï¼ˆWebConfigï¼‰
```rust
pub struct WebConfig {
    pub bind_addr: String,     // ç»‘å®šåœ°å€
    pub port: u16,            // ç«¯å£
    pub static_dir: Option<String>, // é™æ€æ–‡ä»¶ç›®å½•
    // ç§»é™¤äº†: mongodb_config, redis_config ç­‰å¤æ‚é…ç½®
}
```

### ä¾èµ–å…³ç³»å›¾

```
WebServer
â”œâ”€â”€ WebConfig (ç®€åŒ–é…ç½®)
â”œâ”€â”€ AppState (è½»é‡çŠ¶æ€)
â”œâ”€â”€ Routes (7ä¸ªæ ¸å¿ƒè·¯ç”±)
â”œâ”€â”€ Handlers
â”‚   â”œâ”€â”€ Pages (ä¸»é¡µã€é¢„è§ˆ)
â”‚   â””â”€â”€ API (7ä¸ªç«¯ç‚¹)
â”œâ”€â”€ Templates (ç²¾ç®€æ¨¡æ¿)
â””â”€â”€ é™æ€èµ„æº (å¤§å¹…å‡å°‘)
```

## ğŸ“ˆ æ€§èƒ½ç‰¹å¾åˆ†æ

### å¯åŠ¨æ€§èƒ½
- **å¯åŠ¨æ—¶é—´**: <1ç§’ï¼ˆç§»é™¤äº†æ•°æ®åº“è¿æ¥ï¼‰
- **å†…å­˜å ç”¨**: <50MBï¼ˆç²¾ç®€çŠ¶æ€ç®¡ç†ï¼‰
- **äºŒè¿›åˆ¶å¤§å°**: æ˜¾è‘—å‡å°ï¼ˆç§»é™¤MongoDBç­‰ä¾èµ–ï¼‰

### è¿è¡Œæ—¶æ€§èƒ½
- **è·¯ç”±è§£æ**: 85%å‡å°‘çš„è·¯ç”±æ•°é‡æå‡äº†è·¯ç”±åŒ¹é…é€Ÿåº¦
- **è¯·æ±‚å¤„ç†**: ç®€åŒ–çš„å¤„ç†å™¨é€»è¾‘å‡å°‘äº†å¤„ç†å»¶è¿Ÿ
- **èµ„æºæœåŠ¡**: ç²¾ç®€çš„é™æ€èµ„æºå‡å°‘äº†å¸¦å®½ä½¿ç”¨

### å¹¶å‘æ€§èƒ½
- **è¿æ¥å¤„ç†**: ä½¿ç”¨Axumçš„é«˜æ€§èƒ½å¼‚æ­¥å¤„ç†
- **CPUå¯†é›†å‹ä»»åŠ¡**: ä½¿ç”¨ `spawn_blocking` é¿å…é˜»å¡
- **å†…å­˜ç®¡ç†**: Arcå…±äº«çŠ¶æ€ï¼Œé¿å…ä¸å¿…è¦çš„å…‹éš†

## ğŸ¯ è½»é‡åŒ–æ”¹é€ æ•ˆæœ

### ç§»é™¤çš„ç»„ä»¶
- âœ… MongoDBæ•°æ®åº“æ”¯æŒå’Œç›¸å…³é…ç½®
- âœ… å¤æ‚çš„åº“ç®¡ç†ç³»ç»Ÿ (`src/web/library/`)
- âœ… æ‰¹é‡ç¿»è¯‘UIç»„ä»¶å’Œç›¸å…³è·¯ç”±
- âœ… V2 APIç³»ç»Ÿå’Œç»Ÿè®¡åŠŸèƒ½
- âœ… å¤æ‚çš„å‰ç«¯CSS/JSç»„ä»¶
- âœ… æ‹¦æˆªå™¨è„šæœ¬å’Œæ™ºèƒ½è·¯ç”±

### ä¿ç•™çš„æ ¸å¿ƒåŠŸèƒ½
- âœ… ä¹¦ç­¾è„šæœ¬ç”Ÿæˆå’Œä½¿ç”¨
- âœ… ç½‘é¡µèµ„æºå¤„ç†å’Œå†…åµŒ
- âœ… å¯é€‰çš„ç¿»è¯‘åŠŸèƒ½
- âœ… é¢„è§ˆé¡µé¢æ˜¾ç¤º
- âœ… åŸºç¡€çš„ç¼“å­˜ç®¡ç†
- âœ… ä¸»é¢˜ç³»ç»Ÿæ”¯æŒ

## ğŸ” ä»£ç è´¨é‡åˆ†æ

### ä¼˜ç‚¹
1. **æ¨¡å—åŒ–è®¾è®¡**: æ¸…æ™°çš„æ¨¡å—åˆ†ç¦»å’ŒèŒè´£åˆ’åˆ†
2. **é”™è¯¯å¤„ç†**: å®Œå–„çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
3. **ç±»å‹å®‰å…¨**: ä½¿ç”¨Rustçš„ç±»å‹ç³»ç»Ÿç¡®ä¿å®‰å…¨æ€§
4. **å¼‚æ­¥æ”¯æŒ**: å……åˆ†åˆ©ç”¨Tokioå¼‚æ­¥è¿è¡Œæ—¶
5. **é…ç½®çµæ´»**: åŸºäºç¯å¢ƒå˜é‡çš„é…ç½®ç³»ç»Ÿ

### å¯ä¼˜åŒ–ç‚¹
1. **æ¨¡æ¿ç³»ç»Ÿ**: å½“å‰é¢„è§ˆé¡µé¢ä½¿ç”¨å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œå¯è€ƒè™‘ä½¿ç”¨æ¨¡æ¿å¼•æ“
2. **ç¼“å­˜ç­–ç•¥**: å¯ä»¥æ·»åŠ æ›´æ™ºèƒ½çš„ç¼“å­˜ç­–ç•¥
3. **é”™è¯¯é¡µé¢**: é”™è¯¯é¡µé¢çš„ç”¨æˆ·ä½“éªŒå¯ä»¥è¿›ä¸€æ­¥ä¼˜åŒ–
4. **ç›‘æ§æ”¯æŒ**: å¯ä»¥æ·»åŠ åŸºç¡€çš„ç›‘æ§å’Œå¥åº·æ£€æŸ¥ç«¯ç‚¹

## ğŸš€ ä½¿ç”¨ä½“éªŒåˆ†æ

### ç”¨æˆ·å·¥ä½œæµç¨‹
1. **å¯åŠ¨æœåŠ¡**: `cargo run --bin monolith-web --features="web"`
2. **è·å–ä¹¦ç­¾**: è®¿é—® `http://localhost:7080`
3. **å®‰è£…ä¹¦ç­¾**: æ‹–æ‹½ä¹¦ç­¾è„šæœ¬åˆ°æµè§ˆå™¨ä¹¦ç­¾æ 
4. **ä½¿ç”¨ä¹¦ç­¾**: åœ¨ä»»æ„ç½‘é¡µç‚¹å‡»ä¹¦ç­¾ï¼Œè‡ªåŠ¨å¤„ç†å¹¶è·³è½¬åˆ°é¢„è§ˆé¡µé¢

### ä¼˜åŠ¿
- **ç®€å•æ˜“ç”¨**: ä¸€é”®å¼çš„ä¹¦ç­¾è„šæœ¬ä½“éªŒ
- **å¿«é€Ÿå“åº”**: ç²¾ç®€æ¶æ„å¸¦æ¥çš„å¿«é€Ÿå“åº”
- **èµ„æºè½»é‡**: æœ€å°åŒ–çš„èµ„æºå ç”¨
- **éƒ¨ç½²ç®€å•**: æ— éœ€æ•°æ®åº“ç­‰å¤–éƒ¨ä¾èµ–

## ğŸ“‹ æ€»ç»“

Monolith Web æ¨¡å—çš„è½»é‡åŒ–æ”¹é€ æ˜¯æˆåŠŸçš„ï¼Œå®ç°äº†ä»¥ä¸‹ç›®æ ‡ï¼š

1. **åŠŸèƒ½èšç„¦**: ä¸“æ³¨äºä¹¦ç­¾è„šæœ¬é©±åŠ¨çš„ç½‘é¡µå¤„ç†
2. **æ¶æ„ç®€åŒ–**: è·¯ç”±æ•°é‡å‡å°‘85%ï¼Œç§»é™¤å¤æ‚ç»„ä»¶
3. **æ€§èƒ½æå‡**: å¯åŠ¨é€Ÿåº¦ã€å“åº”é€Ÿåº¦ã€èµ„æºå ç”¨éƒ½æœ‰æ˜¾è‘—æ”¹å–„
4. **ç»´æŠ¤ä¾¿åˆ©**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œä¾èµ–å…³ç³»ç®€å•

è¯¥æ¶æ„ä¸ºç”¨æˆ·æä¾›äº†"ç®€å•ã€ä¾¿æ·ã€è½»é‡"çš„ç½‘é¡µå¤„ç†ä½“éªŒï¼ŒåŒæ—¶ä¿æŒäº†æ ¸å¿ƒåŠŸèƒ½çš„å®Œæ•´æ€§å’Œå¯æ‰©å±•æ€§ã€‚

## ğŸ¯ æ¨èä¼˜åŒ–æ–¹å‘

1. **å¢å¼ºé¢„è§ˆä½“éªŒ**: æ”¹è¿›é¢„è§ˆé¡µé¢çš„äº¤äº’æ€§å’Œè§†è§‰æ•ˆæœ
2. **æ·»åŠ æ‰¹é‡å¤„ç†**: æ”¯æŒå¤šä¸ªURLçš„æ‰¹é‡å¤„ç†
3. **ä¼˜åŒ–ä¹¦ç­¾è„šæœ¬**: å¢åŠ æ›´å¤šè‡ªå®šä¹‰é€‰é¡¹å’Œé”™è¯¯å¤„ç†
4. **ç›‘æ§æ”¯æŒ**: æ·»åŠ åŸºç¡€çš„æ€§èƒ½ç›‘æ§å’Œå¥åº·æ£€æŸ¥
5. **æ–‡æ¡£å®Œå–„**: è¡¥å……APIæ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—